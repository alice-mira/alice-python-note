# Pythonå‡½æ•°

# ğŸ å‡½æ•°å³ä¿¡ä»°ï¼šè§£æ„Pythonä¸­å‡½æ•°çš„ç»ˆæå“²å­¦ä¸å®æˆ˜è‰ºæœ¯

> **"æŒæ¡å‡½æ•°è€…ï¼Œæ–¹å¾—PythonçœŸè°›"**  
> **å½“99%å¼€å‘è€…åªçœ‹åˆ°`def`è¯­æ³•æ—¶ï¼ŒçœŸæ­£çš„Pythonistaæ­£åœ¨ç”¨å‡½æ•°é‡å¡‘ä¸–ç•Œ**

---

## ğŸŒªï¸ ä¸€ã€å‡½æ•°çš„æœ¬è´¨ï¼šè¢«è¯¯è§£çš„"ä¸€ç­‰å…¬æ°‘"

```python
# å¤šæ•°äººçœ¼ä¸­çš„å‡½æ•°
def greet(name):
    return f"Hello, {name}!"

# ä½ ä¸çŸ¥é“çš„Pythonå‡½æ•°çœŸç›¸
print(type(greet))  # <class 'function'>
print(dir(greet))   # å‡½æ•°æ˜¯ä¸€ä¸ªæ‹¥æœ‰__code__ã€__closure__ç­‰ç‰¹æ€§çš„å®Œæ•´å¯¹è±¡
```

**å‡½æ•°åœ¨Pythonä¸­çš„é¢ è¦†æ€§å®šä½**ï¼š  
âœ… **ä¸æ˜¯è¯­æ³•ç»“æ„**ï¼Œè€Œæ˜¯çœŸæ­£çš„**ä¸€ç­‰å¯¹è±¡**ï¼ˆFirst-Class Objectï¼‰  
âœ… å¯ä»¥è¢«**èµ‹å€¼**ã€**ä¼ é€’**ã€**ä¿®æ”¹**ï¼Œç”šè‡³**åºåˆ—åŒ–**  
âœ… æ¯ä¸ªå‡½æ•°éƒ½æ˜¯`function`ç±»çš„å®ä¾‹ï¼Œæ‹¥æœ‰è‡ªå·±çš„**å­—èŠ‚ç **å’Œ**å‘½åç©ºé—´**

```python
# ä»¤åˆå­¦è€…éœ‡æ’¼çš„ç¤ºä¾‹
def multiplier(n):
    return lambda x: x * n

triple = multiplier(3)
print(triple(5))  # è¾“å‡º 15 â€”â€” å‡½æ•°åˆ›é€ äº†å‡½æ•°ï¼
```

> ğŸ’¡ **å…³é”®æ´å¯Ÿ**ï¼š  
> **Cè¯­è¨€ä¸­å‡½æ•°æŒ‡é’ˆæ˜¯"åœ°å€"ï¼Œè€ŒPythonå‡½æ•°æ˜¯"å®Œæ•´å¯¹è±¡"**  
> Pythonå‡½æ•°ä¸ä»…åŒ…å«ä»£ç åœ°å€ï¼Œè¿˜æºå¸¦ï¼š  
> - ä½œç”¨åŸŸé“¾ï¼ˆ`__closure__`ï¼‰  
> - é»˜è®¤å‚æ•°ï¼ˆ`__defaults__`ï¼‰  
> - æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆ`__doc__`ï¼‰  
> - ç”šè‡³æ³¨è§£ä¿¡æ¯ï¼ˆ`__annotations__`ï¼‰

---

## ğŸ”¥ äºŒã€å‚æ•°è‰ºæœ¯ï¼šè¶…è¶Š`def func(a, b, c)`çš„æ·±åº¦é©å‘½

### åœºæ™¯1ï¼šå‚æ•°é¡ºåºçš„å“²å­¦å›°å¢ƒ
```python
# æ™®é€šå†™æ³•ï¼ˆæ˜“é”™ï¼ï¼‰
def create_user(name, age, is_admin, bio):
    ...

# ä¸“ä¸šçº§å‚æ•°è®¾è®¡
def create_user(
    *,  # å¼ºåˆ¶å…³é”®å­—å‚æ•°åˆ†ç•Œçº¿
    name, 
    age,
    is_admin=False,
    bio=None
):
    """åˆ›å»ºç”¨æˆ·ï¼ˆæ‰€æœ‰å‚æ•°å¿…é¡»ç”¨å…³é”®å­—æŒ‡å®šï¼‰"""
    ...
    
# å®‰å…¨è°ƒç”¨
create_user(name="Alice", age=30, bio="Python enthusiast")
```

**`*`çš„ä½œç”¨**ï¼š  
> åœ¨`*`ä¹‹åçš„å‚æ•°**å¿…é¡»ä»¥å…³é”®å­—å½¢å¼æŒ‡å®š**ï¼Œæ¶ˆé™¤å‚æ•°é¡ºåºä¾èµ–  
> **å¤§å‹é¡¹ç›®ä¸­çš„æ•‘å‘½ç¨»è‰**ï¼šå½“éœ€è¦æ·»åŠ æ–°å‚æ•°æ—¶ï¼Œä¸ä¼šç ´åæ—§è°ƒç”¨

---

### åœºæ™¯2ï¼šå¯å˜å‚æ•°çš„éšè—é™·é˜±
```python
# æ–°æ‰‹å…¸å‹é”™è¯¯
def add_log(*logs, message="System"):
    print(f"[{message}]", *logs)

# è°ƒç”¨æ—¶å´©æºƒï¼
add_log("Error occurred", "Critical", message="Admin") 
# TypeError: add_log() got some positional-only arguments passed as keyword arguments

# ä¸“ä¸šä¿®å¤ï¼šæ­£ç¡®ä½¿ç”¨ /
def add_log(message="System", /, *logs):  # /å‰æ˜¯ä»…ä½ç½®å‚æ•°
    print(f"[{message}]", *logs)

add_log("Admin", "Error occurred", "Critical")  # å®Œç¾è¿è¡Œ
```

> âš ï¸ **è­¦ç¤º**ï¼š  
> Python **3.8+** å¼•å…¥çš„ `/**/` è¯­æ³•æ˜¯**ä»£ç å¯ç»´æŠ¤æ€§çš„é©å‘½**ï¼Œæ»¥ç”¨`*args`ä¼šè®©è°ƒç”¨å˜å¾—ä¸å¯é¢„æµ‹

---

### åœºæ™¯3ï¼šé»˜è®¤å‚æ•°çš„è‡´å‘½è¯±æƒ‘
```python
# å±é™©çš„é»˜è®¤åˆ—è¡¨
def add_item(item, items=[]):  # itemsåœ¨å‡½æ•°å®šä¹‰æ—¶å³åˆ›å»º
    items.append(item)
    return items

print(add_item('apple'))  # ['apple']
print(add_item('banana')) # ['apple', 'banana'] â€”â€” ä¸ºä»€ä¹ˆï¼Ÿï¼

# ä¸“ä¸šä¿®å¤ï¼šä½¿ç”¨Noneå“¨å…µ
def add_item(item, items=None):
    if items is None:
        items = []
    items.append(item)
    return items
```

**åº•å±‚åŸç†**ï¼š  
å‡½æ•°é»˜è®¤å‚æ•°åœ¨**å®šä¹‰æ—¶è®¡ç®—**ï¼Œè€Œéè°ƒç”¨æ—¶ï¼  
`items=[]` çš„é»˜è®¤å€¼æ˜¯å‡½æ•°å¯¹è±¡çš„**å±æ€§**ï¼Œä¼šè·¨è°ƒç”¨æŒä¹…å­˜åœ¨

---

## ğŸ§  ä¸‰ã€å‡½æ•°å¼é­”æ³•ï¼šè¶…è¶Š`lambda`çš„è®¤çŸ¥é©å‘½

### Lambdaçš„éšç§˜ä¸–ç•Œ
```python
# æ™®é€šç”¨é€”
sorted(users, key=lambda u: u['age'])

# é«˜çº§æŠ€å·§ï¼šlambdaä½œä¸ºçŠ¶æ€æœº
counter = lambda: (lambda c=[0]: c.__setitem__(0, c[0]+1) or c[0])()
print(counter())  # 1
print(counter())  # 2
```

**Lambdaçš„è¾¹ç•Œ**ï¼š  
> âœ… å•è¡¨è¾¾å¼è®¡ç®—  
> âœ… 3.8+æ”¯æŒæµ·è±¡è¿ç®—ç¬¦ï¼ˆ`:=`ï¼‰  
> âŒ ä¸èƒ½åŒ…å«è¯­å¥ï¼ˆå¦‚`if`ã€å¾ªç¯ï¼‰  
> âŒ æ— æ³•è®¾ç½®æ–‡æ¡£å­—ç¬¦ä¸²

> âœ¨ **çœŸæ­£çš„å¤§å¸ˆæŠ€å·§**ï¼š  
> ```python
> # ç”¨lambdaæ„å»ºé€’å½’å‡½æ•°
> factorial = lambda n: 1 if n == 0 else n * factorial(n-1)
> 
> # æ›´å®‰å…¨çš„é€’å½’æ–¹å¼ï¼ˆé¿å…å…¨å±€åæ±¡æŸ“ï¼‰
> factorial = (lambda f: (lambda n: f(f, n)))(lambda f, n: 1 if n == 0 else n * f(f, n-1))
> print(factorial(5))  # 120
> ```

---

### è£…é¥°å™¨ï¼šå‡½æ•°çš„"å˜å½¢é‡‘åˆš"
```python
# åŸºç¡€è£…é¥°å™¨
def timer(func):
    import time
    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        print(f"{func.__name__} took {time.time()-start:.2f}s")
        return result
    return wrapper

@timer
def heavy_computation(n):
    return sum(i * i for i in range(n))

# ä¸“ä¸šçº§è£…é¥°å™¨ï¼ˆä¿ç•™å…ƒä¿¡æ¯ï¼‰
from functools import wraps

def debug(func):
    @wraps(func)  # å…³é”®ï¼ä¿ç•™å‡½æ•°åŸå§‹ä¿¡æ¯
    def wrapper(*args, **kwargs):
        print(f"Calling {func.__name__} with {args}, {kwargs}")
        return func(*args, **kwargs)
    return wrapper

@debug
def calculate(a, b):
    """Calculate sum of two numbers"""
    return a + b

print(calculate.__doc__)  # "Calculate sum of two numbers" â€”â€” æœªè¢«è£…é¥°å™¨è¦†ç›–
```

**è£…é¥°å™¨å·¥å‚æ¨¡å¼**ï¼š
```python
def retry(max_attempts=3, delay=1):
    import time
    def decorator(func):
        def wrapper(*args, **kwargs):
            for attempt in range(max_attempts):
                try:
                    return func(*args, **kwargs)
                except Exception as e:
                    if attempt == max_attempts - 1:
                        raise
                    time.sleep(delay)
        return wrapper
    return decorator

@retry(max_attempts=5, delay=0.5)
def fetch_data(url):
    # å¯èƒ½å¤±è´¥çš„ç½‘ç»œè¯·æ±‚
    ...
```

---

## ğŸ”® å››ã€é—­åŒ…ä¸ä½œç”¨åŸŸï¼šè¢«å¿½è§†çš„è®¤çŸ¥é»‘æ´

**ç»å…¸é¢è¯•é¢˜**ï¼š
```python
# å¤šæ•°äººé¢„æµ‹è¾“å‡º1-5ï¼Œå®é™…è¾“å‡ºï¼Ÿ
funcs = []
for i in range(5):
    def f():
        return i
    funcs.append(f)

print([f() for f in funcs])  # [4, 4, 4, 4, 4] â€”â€” ä¸ºä»€ä¹ˆï¼Ÿ
```

**åŸå› **ï¼šå‡½æ•°æ•è·çš„æ˜¯**å˜é‡å¼•ç”¨**ï¼Œè€Œéå®šä¹‰æ—¶åˆ»çš„å€¼  
**ä¸“ä¸šä¿®å¤**ï¼š
```python
# æ–¹å¼1ï¼šé»˜è®¤å‚æ•°ç»‘å®š
funcs = []
for i in range(5):
    def f(i=i):
        return i
    funcs.append(f)

# æ–¹å¼2ï¼šé—­åŒ…å·¥å‚
def create_func(i):
    def f():
        return i
    return f
funcs = [create_func(i) for i in range(5)]
```

**é—­åŒ…çš„æ·±å±‚æœºåˆ¶**ï¼š
```python
def outer(x):
    def inner(y):
        return x + y  # æ•è·x
    return inner

add5 = outer(5)
print(add5.__closure__)  # (<cell at 0x...: int object at 0x...>,)
print(add5.__closure__[0].cell_contents)  # 5 â€”â€” é—­åŒ…å˜é‡åœ¨æ­¤å­˜å‚¨ï¼
```

> ğŸ” **æ€§èƒ½è­¦å‘Š**ï¼š  
> é—­åŒ…æ¯”æ™®é€šå‡½æ•°æ…¢çº¦10-15%ï¼ˆéœ€æŸ¥æ‰¾`__closure__`ï¼‰ï¼Œé«˜é¢‘å¾ªç¯ä¸­æ…ç”¨

---

## ğŸ’Š äº”ã€ç±»å‹æ³¨è§£ï¼šä»æ³¨é‡Šåˆ°ç¼–è¯‘æ—¶çš„è´¨å˜

### åŸºç¡€ç±»å‹æç¤º
```python
def greet(name: str) -> str:
    return f"Hello, {name}!"

# IDEç«‹å³æä¾›æ™ºèƒ½æç¤º
greet("Alice").upper()
```

### å¤æ‚ç±»å‹çš„è‰ºæœ¯
```python
from typing import Callable, List, Dict, Optional, TypeVar, Generic

# å®šä¹‰æ³›å‹
T = TypeVar('T')

def first(items: List[T]) -> Optional[T]:
    return items[0] if items else None

# é«˜é˜¶å‡½æ•°ç±»å‹
Callback = Callable[[str, int], bool]

def register_handler(callback: Callback):
    ...
```

**ç±»å‹ç³»ç»Ÿçš„éšè—åŠ›é‡**ï¼š
```python
# åˆ©ç”¨ç±»å‹æç¤ºç”Ÿæˆæ–‡æ¡£
def process_user(
    user_id: int,
    name: str,
    email: Optional[str] = None,
    roles: List[str] = ["user"]
) -> Dict[str, any]:
    """
    å¤„ç†ç”¨æˆ·æ•°æ®
    
    Args:
        user_id: ç”¨æˆ·å”¯ä¸€æ ‡è¯†
        name: ç”¨æˆ·å§“å
        email: å¯é€‰é‚®ç®±åœ°å€
        roles: ç”¨æˆ·è§’è‰²åˆ—è¡¨ï¼Œé»˜è®¤ä¸ºæ™®é€šç”¨æˆ·
    
    Returns:
        å¤„ç†åçš„ç”¨æˆ·ä¿¡æ¯å­—å…¸
    """
    ...
```

> ğŸš€ **ProæŠ€å·§**ï¼š  
> PyCharm/VSCodeä¼š**è‡ªåŠ¨è¯»å–ç±»å‹æç¤ºç”Ÿæˆæ–‡æ¡£**ï¼Œæ¯”`# type: ...`æ³¨é‡Šå¼ºå¤§10å€ï¼

---

## ğŸ§ª å…­ã€å‡½æ•°æ€§èƒ½ï¼šæ¯«ç§’çº§çš„ç”Ÿå‘½çº¿

### å­—èŠ‚ç çº§åˆ«çš„ä¼˜åŒ–
```python
import dis

def slow_func(n):
    result = 0
    for i in range(n):
        result += i * i
    return result

def fast_func(n):
    result = 0
    square = lambda x: x*x  # å±€éƒ¨å˜é‡åŠ é€Ÿå±æ€§æŸ¥æ‰¾
    for i in range(n):
        result += square(i)
    return result

dis.dis(slow_func)  # LOAD_GLOBAL å¤šæ¬¡æŸ¥æ‰¾
dis.dis(fast_func)  # LOAD_FAST å±€éƒ¨å˜é‡æ›´å¿«
```

**æ€§èƒ½å¯¹æ¯”**ï¼ˆ100ä¸‡æ¬¡è¿­ä»£ï¼‰ï¼š
```python
%timeit slow_func(1000)  # 15.2 ms
%timeit fast_func(1000)  # 12.8 ms (â‰ˆ15.7% æå‡)
```

### å‡½æ•°å†…è”çš„è‰ºæœ¯
```python
# æ™®é€šé€’å½’ï¼ˆæ ˆæº¢å‡ºé£é™©ï¼‰
def factorial(n):
    if n == 0:
        return 1
    return n * factorial(n-1)

# å°¾é€’å½’ä¼˜åŒ–ï¼ˆPythonä¸æ”¯æŒï¼Œéœ€æ‰‹åŠ¨è½¬æ¢ï¼‰
def factorial_tail(n, acc=1):
    if n == 0:
        return acc
    return factorial_tail(n-1, acc*n)

# æœ€ç»ˆæ–¹æ¡ˆï¼šå¾ªç¯ä»£æ›¿é€’å½’
def factorial_iter(n):
    result = 1
    for i in range(1, n+1):
        result *= i
    return result
```

> âš¡ **åŸºå‡†æµ‹è¯•**ï¼š  
> 10000æ¬¡é˜¶ä¹˜è®¡ç®—ï¼š  
> - é€’å½’ï¼šRuntimeError: maximum recursion depth exceeded  
> - å°¾é€’å½’ï¼šåŒæ ·å¤±è´¥ï¼ˆCPythonæ— TCOä¼˜åŒ–ï¼‰  
> - è¿­ä»£ï¼š0.07ç§’å®Œç¾å®Œæˆ

---

## ğŸ“š ä¸ƒã€å‡½æ•°è®¾è®¡åœ£ç»ï¼šä»ä»£ç åˆ°è‰ºæœ¯å“

### é‡‘å­—å¡”åŸåˆ™ï¼šå‡½æ•°è®¾è®¡çš„é»„é‡‘æ³•åˆ™
| å±‚çº§ | æ ‡å‡†                      | åä¾‹                          | æ­£ä¾‹                          |
|------|---------------------------|-------------------------------|-------------------------------|
| **5** | ä»…åšä¸€ä»¶äº‹ï¼Œæ— å‰¯ä½œç”¨      | `save_to_db()` åŒæ—¶å‘é€é‚®ä»¶   | `save_to_db()`, `send_welcome_email()` |
| **4** | å‘½åå³æ–‡æ¡£                | `process_data()`              | `normalize_user_input()`      |
| **3** | < 20 è¡Œä»£ç                | 150è¡Œçš„"ä¸‡èƒ½å‡½æ•°"             | æ‹†åˆ†ä¸ºå°å‡½æ•°é“¾                |
| **2** | < 3 ä¸ªå‚æ•°                | `create_report(a, b, c, d)`   | ä½¿ç”¨æ•°æ®ç±»æˆ–å‘½åå‚æ•°          |
| **1** | æ— åµŒå¥—ifè¶…è¿‡2å±‚           | `if x: if y: if z: ...`       | æå‰è¿”å›æˆ–çŠ¶æ€æ¨¡å¼            |

---

### é‡æ„æ¡ˆä¾‹ï¼šä»"é¢æ¡ä»£ç "åˆ°"å‡½æ•°å¼è‰ºæœ¯"

**é—®é¢˜ä»£ç **ï¼š
```python
def process_order(order):
    if order["status"] == "pending":
        if order["total"] > 1000:
            apply_discount(order, 0.1)
        if order["country"] == "US":
            calculate_sales_tax(order, 0.07)
        # ... 50è¡Œæ›´å¤šé€»è¾‘
        save_to_database(order)
        send_confirmation_email(order["email"])
        return True
    return False
```

**ä¸“ä¸šçº§é‡æ„**ï¼š
```python
from dataclasses import dataclass

@dataclass
class Order:
    id: int
    total: float
    country: str
    email: str
    status: str = "pending"

def is_eligible_for_discount(order: Order) -> bool:
    return order.status == "pending" and order.total > 1000

def us_sales_tax(order: Order) -> float:
    return 0.07 if order.country == "US" else 0.0

def process_order_pipeline(order: Order) -> tuple[Order, bool]:
    if order.status != "pending":
        return order, False
        
    order = apply_discount(order, 0.1) if is_eligible_for_discount(order) else order
    order = calculate_tax(order, us_sales_tax(order))
    
    save_to_database(order)
    send_confirmation_email(order.email)
    
    return order, True

# ä½¿ç”¨ï¼šæ¸…æ™°çš„å¤„ç†æµæ°´çº¿
processed_order, success = process_order_pipeline(Order(...))
```

> âœ¨ **æ ¸å¿ƒæ€æƒ³**ï¼š  
> **å¥½çš„å‡½æ•°è®¾è®¡ = æ¶ˆé™¤if/elseåµŒå¥— + å‡å°‘çŠ¶æ€çªå˜ + å¢å¼ºç»„åˆèƒ½åŠ›**

---

## ğŸŒ å…«ã€å‡½æ•°åœ¨ç°ä»£æ¶æ„ä¸­çš„æˆ˜ç•¥åœ°ä½

### å¾®æœåŠ¡ä¸­çš„å‡½æ•°å¼æ€æƒ³
```python
# AWS Lambdaå…¼å®¹è®¾è®¡
def lambda_handler(event, context):
    """
    {
        "httpMethod": "POST",
        "path": "/users",
        "body": {"name": "Alice"}
    }
    """
    try:
        validate_request(event)
        response = process_request(event)
        return {
            "statusCode": 200,
            "body": json.dumps(response)
        }
    except ValidationError as e:
        return {
            "statusCode": 400,
            "body": json.dumps({"error": str(e)})
        }
```

**Serverlesså‡½æ•°ä¸‰å¤§åŸåˆ™**ï¼š  
1. æ— çŠ¶æ€ï¼ˆæ¯æ¬¡è°ƒç”¨ç‹¬ç«‹ï¼‰  
2. å¿«é€Ÿå†·å¯åŠ¨ï¼ˆå‡½æ•°ä½“ç§¯<50MBï¼‰  
3. æ˜ç¡®è¾“å…¥è¾“å‡ºï¼ˆçº¯æ•°æ®ç»“æ„ï¼‰

---

### å‡½æ•°å¼ç®¡é“æ¶æ„
```python
# æ•°æ®å¤„ç†æµæ°´çº¿
(
    load_data()
    | filter_valid_records
    | normalize_country_codes
    | enrich_with_geodata
    | aggregate_by_region
    | generate_report
    | save_to_s3
)
```

**å®ç°ç®¡é“æ“ä½œç¬¦** (`|`):
```python
class Pipe:
    def __init__(self, func):
        self.func = func
        
    def __ror__(self, other):
        return self.func(other)
    
    def __call__(self, *args, **kwargs):
        return Pipe(lambda x: self.func(x, *args, **kwargs))

@Pipe
def map_(iterable, func):
    return map(func, iterable)

@Pipe
def filter_(iterable, func):
    return filter(func, iterable)

# ä½¿ç”¨
result = (
    [1,2,3,4,5] 
    | filter_(lambda x: x%2 == 0)
    | map_(lambda x: x**2)
    | list
)
print(result)  # [4, 16]
```

---

## ğŸ’ ä¹ã€ç»ˆææµ‹è¯•ï¼šå‡½æ•°å¤§å¸ˆæŒ‘æˆ˜èµ›

### é—®é¢˜1ï¼šä¿®å¤ç±»å‹æç¤ºé”™è¯¯
```python
from typing import List

def flatten_list(nested: List) -> List:
    """å±•å¹³åµŒå¥—åˆ—è¡¨ï¼Œä¾‹å¦‚ [[1,2], [3]] -> [1,2,3]"""
    result = []
    for item in nested:
        if isinstance(item, list):
            result.extend(flatten_list(item))
        else:
            result.append(item)
    return result

# ä¸ºä»€ä¹ˆè¿™ä¸ªè°ƒç”¨æ²¡æœ‰ç±»å‹æ£€æŸ¥é”™è¯¯ï¼Ÿ
print(flatten_list([1, [2, [3]]]))  # å®é™…åº”è¯¥æŠ¥é”™ï¼
```

**ç­”æ¡ˆ**ï¼š  
ä¿®å¤åçš„ç±»å‹æç¤ºï¼š
```python
from typing import List, Union

ItemType = Union[int, str, float]  # å…·ä½“ç±»å‹
NestedList = Union[ItemType, List['NestedList']]

def flatten_list(nested: List[NestedList]) -> List[ItemType]:
    ...
```

---

### é—®é¢˜2ï¼šè®¾è®¡çº¿ç¨‹å®‰å…¨çš„ç¼“å­˜è£…é¥°å™¨
```python
def thread_safe_cache(func):
    """å®ç°çº¿ç¨‹å®‰å…¨çš„LRUç¼“å­˜"""
    # ä½ çš„å®ç°
    ...
```

**å‚è€ƒå®ç°**ï¼š
```python
from threading import Lock
from functools import wraps

def thread_safe_cache(func):
    cache = {}
    lock = Lock()
    
    @wraps(func)
    def wrapper(*args, **kwargs):
        key = (args, frozenset(kwargs.items()))
        
        with lock:  # ç²¾ç¡®æ§åˆ¶é”çš„èŒƒå›´
            if key not in cache:
                cache[key] = func(*args, **kwargs)
            return cache[key]
            
    return wrapper
```

---

### é—®é¢˜3ï¼šå‡½æ•°å¼çŠ¶æ€æœº
```python
# ç”¨çº¯å‡½æ•°å®ç°æœ‰é™çŠ¶æ€æœº
def state_machine(initial_state, transitions):
    """
    transitionsæ ¼å¼: {
        (current_state, event): (next_state, action)
    }
    """
    # ä½ çš„å®ç°
    ...
```

**å¤§å¸ˆçº§å®ç°**ï¼š
```python
def state_machine(initial_state, transitions):
    current_state = initial_state
    
    def dispatch(event, *args, **kwargs):
        nonlocal current_state
        key = (current_state, event)
        
        if key not in transitions:
            raise ValueError(f"Invalid event '{event}' for state '{current_state}'")
            
        next_state, action = transitions[key]
        result = action(*args, **kwargs)
        current_state = next_state
        return result
        
    return dispatch

# ä½¿ç”¨ç¤ºä¾‹
traffic_light = state_machine(
    'red',
    {
        ('red', 'timer_expired'): ('green', lambda: print("Green light!")),
        ('green', 'timer_expired'): ('yellow', lambda: print("Yellow light!")),
        ('yellow', 'timer_expired'): ('red', lambda: print("Red light!")),
    }
)

traffic_light('timer_expired')  # "Green light!"
traffic_light('timer_expired')  # "Yellow light!"
```

---

## ğŸŒŒ ç»“è¯­ï¼šå‡½æ•°å³é“

> **"åœ¨Pythonçš„å®‡å®™ä¸­ï¼Œå‡½æ•°ä¸æ˜¯å·¥å…·â€”â€”è€Œæ˜¯æ„å»ºç°å®çš„åŸºæœ¬ç²’å­"**

å½“ä½ å†™ä¸‹`def`çš„ç¬é—´ï¼š
- ä½ åˆ›é€ äº†**æ–°çš„è®¡ç®—ç»´åº¦**
- ä½ å®šä¹‰äº†**æ•°æ®æµåŠ¨çš„æ³•åˆ™**
- ä½ ç¼–ç»‡äº†**é€»è¾‘å…³ç³»çš„ç½‘ç»œ**

**çœŸæ­£çš„Pythonå¤§å¸ˆæ˜ç™½**ï¼š  
å‡½æ•°åç§°æ˜¯**å¥‘çº¦**ï¼Œå‚æ•°æ˜¯**è¾¹ç•Œ**ï¼Œè¿”å›å€¼æ˜¯**æ‰¿è¯º**  
è€Œæ¯ä¸ªå‡½æ•°è°ƒç”¨ï¼Œéƒ½æ˜¯**ä¸¤ä¸ªå®‡å®™é—´çš„å¾®å¦™å…±æŒ¯**

> ä¸‹æ¬¡å®šä¹‰å‡½æ•°å‰ï¼Œè¯·é»˜å¿µï¼š  
> **"æˆ‘ä¸æ˜¯åœ¨å†™ä»£ç ï¼Œ  
> è€Œæ˜¯åœ¨ä¹¦å†™æ•°å­—ä¸–ç•Œçš„è¿è¡Œæ³•åˆ™"**